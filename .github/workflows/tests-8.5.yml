name: Run phpunit tests on 8.5

on: [push]

jobs:
    phpunit:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Code
              uses: actions/checkout@v6
              with:
                  fetch-depth: 1

            - name: Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: "8.5"
                  extensions: intl, zip, zlib, json, openssl, posix
                  coverage: none
                  ini-values: memory_limit=1G, phar.readonly=0

            - name: Verify PHP version
              run: php -v && composer -V

            - name: Install Project Dependencies
              run: composer install --no-interaction --no-ansi --no-progress --ignore-platform-req=php

            - name: setup git
              run: git config --global user.email "phpunit@factorial.io" && git config --global user.name "phpunit" && git config --global init.defaultBranch master

            - name: Run unit tests
              run: ./vendor/bin/phpunit tests --exclude-group docker
              env:
                  # Allow deprecations for PHP 8.5 as dependencies need time to adapt
                  # Deprecations from dependencies (not phabalicious code):
                  # - curl_close() in GuzzleHTTP (transitive dependency)
                  # - null array offset in Twig/Symfony components
                  SYMFONY_DEPRECATIONS_HELPER: weak
